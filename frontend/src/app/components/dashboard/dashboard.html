<div class="mb-8">
  <div
    class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6"
  >
    <h2 class="text-2xl font-bold text-gray-800">Visão Geral</h2>
    <app-month-selector></app-month-selector>
  </div>

  @if (summary(); as data) {
  <!-- 1. Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
      <div class="text-gray-500 font-medium mb-2">Saldo Total</div>
      <div class="text-3xl font-bold text-blue-600">
        {{ data.total_balance | currency : "BRL" }}
      </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
      <div class="text-gray-500 font-medium mb-2">Receitas (Geral)</div>
      <div class="text-3xl font-bold text-green-500">
        + {{ data.income_month | currency : "BRL" }}
      </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
      <div class="text-gray-500 font-medium mb-2">Despesas (Geral)</div>
      <div class="text-3xl font-bold text-red-500">
        - {{ data.expense_month | currency : "BRL" }}
      </div>
    </div>
  </div>

  <!-- 2. Accounts (Contas) - Above Charts -->
  <div class="mb-8">
    <app-account-manager></app-account-manager>
  </div>

  <!-- 3. Charts Section -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
    <div
      class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col"
    >
      <h3 class="text-lg font-bold text-gray-800 mb-4">
        Despesas por Categoria
      </h3>
      @if (data.expenses_by_category.length > 0) {
      <div class="w-full h-[300px] flex justify-center">
        <p-chart
          type="doughnut"
          [data]="chartData"
          [options]="chartOptions"
          class="w-full h-full"
        ></p-chart>
      </div>
      } @else {
      <div class="text-gray-400 italic mt-10 text-center">
        Sem despesas registradas para os filtros selecionados.
      </div>
      }
    </div>

    <div
      class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col"
    >
      <h3 class="text-lg font-bold text-gray-800 mb-4">Evolução Mensal</h3>
      @if (data.evolution && data.evolution.length > 0) {
      <div class="w-full h-[300px] flex justify-center">
        <p-chart
          type="bar"
          [data]="evolutionChartData"
          [options]="evolutionChartOptions"
          class="w-full h-full"
        ></p-chart>
      </div>
      } @else {
      <div class="text-gray-400 italic mt-10 text-center">
        Dados insuficientes para exibir evolução.
      </div>
      }
    </div>
  </div>

  <!-- 4. Metas (Budgets) -->
  <div class="mb-8">
    <app-budget-manager></app-budget-manager>
  </div>

  <!-- 6. Transaction List (Full List, Bottom) -->
  <app-transaction-list></app-transaction-list>

  } @else {
  <div class="flex justify-center items-center h-64">
    <div
      class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
    ></div>
  </div>
  }
</div>
