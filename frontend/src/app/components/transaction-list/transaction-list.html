<div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
  <!-- Main Content: Transaction List -->
  <div class="lg:col-span-8">
    <div class="mb-4 flex gap-2 items-center">
      <p-select
        [options]="flatCategories()"
        [(ngModel)]="selectedCategory"
        optionLabel="label"
        optionValue="value"
        placeholder="Filtrar por Categoria"
        [style]="{ width: '250px' }"
        [filter]="true"
        filterBy="label"
        [showClear]="true"
      >
        <ng-template let-cat pTemplate="item">
          <div [class]="cat.styleClass">
            {{ cat.label }}
          </div>
        </ng-template>
      </p-select>

      <p-button
        label="Nova Transação"
        icon="pi pi-plus"
        (onClick)="openNewTransaction()"
      >
      </p-button>
    </div>

    <div
      class="card bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"
    >
      <p-table
        [value]="transactions()"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="bg-white text-gray-800"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Categoria</th>
            <th>Descrição</th>
            <th>Valor</th>
            <th>Data</th>
            <th>Forma Pagto.</th>
            <th style="width: 5rem"></th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-t>
          <tr>
            <td>
              <div class="flex items-center gap-2">
                <i
                  [class]="t.category?.icon"
                  [style.color]="t.category?.color"
                ></i>
                <span class="font-medium">{{ t.category?.name }}</span>
              </div>
            </td>

            <td>{{ t.description }}</td>

            <td
              class="font-bold"
              [class.text-red-500]="t.type === 'expense'"
              [class.text-green-500]="t.type === 'income'"
            >
              {{ t.type === "expense" ? "-" : "+" }}
              {{ t.amount | currency : "BRL" }}
            </td>

            <td>{{ t.date | date : "dd/MM/yyyy" }}</td>

            <td class="capitalize">
              {{ t.payment_method | paymentFormat }}
            </td>

            <td class="flex gap-1">
              <p-button
                icon="pi pi-pencil"
                severity="info"
                [text]="true"
                [rounded]="true"
                (onClick)="transactionForm.editTransaction($event, t)"
              >
              </p-button>

              <p-button
                icon="pi pi-trash"
                severity="danger"
                [text]="true"
                [rounded]="true"
                (onClick)="deleteTransaction($event, t)"
              >
              </p-button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center p-4 text-gray-500">
              Nenhuma transação encontrada.
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- Sidebar: Recurrences & Upcoming -->
  <div class="lg:col-span-4 flex flex-col gap-6">
    <!-- Recurrences Card -->
    <div class="card bg-white rounded-xl shadow-sm border border-gray-200 p-4">
      <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
        <i class="pi pi-sync text-blue-500"></i> Despesas Recorrentes
      </h3>

      <div
        *ngIf="recurrences().length === 0"
        class="text-gray-500 text-sm italic"
      >
        Nenhuma recorrência ativa.
      </div>

      <div class="flex flex-col gap-3">
        <div
          *ngFor="let r of recurrences()"
          class="flex items-center justify-between border-b border-gray-100 pb-2 last:border-0"
        >
          <div class="flex flex-col">
            <span class="font-medium text-gray-800">{{ r.name }}</span>
            <span class="text-xs text-gray-500 capitalize">{{
              r.periodicity
            }}</span>
          </div>
          <span class="font-bold text-gray-800">
            {{ r.amount | currency : "BRL" }}
          </span>
        </div>
      </div>
    </div>

    <!-- Upcoming Transactions Card -->
    <div class="card bg-white rounded-xl shadow-sm border border-gray-200 p-4">
      <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
        <i class="pi pi-calendar-clock text-orange-500"></i> Próximas Transações
      </h3>

      <div
        *ngIf="upcomingTransactions().length === 0"
        class="text-gray-500 text-sm italic"
      >
        Nenhuma transação futura encontrada.
      </div>

      <div class="flex flex-col gap-3">
        <div
          *ngFor="let t of upcomingTransactions()"
          class="flex items-center justify-between border-b border-gray-100 pb-2 last:border-0"
        >
          <div class="flex flex-col">
            <span class="font-medium text-gray-800">{{ t.description }}</span>
            <span class="text-xs text-gray-500">{{
              t.date | date : "dd/MM"
            }}</span>
          </div>
          <span class="font-bold text-red-500">
            {{ t.amount | currency : "BRL" }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<app-transaction-form (save)="loadTransactions()"></app-transaction-form>
