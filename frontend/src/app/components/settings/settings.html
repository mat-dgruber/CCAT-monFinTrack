<div class="max-w-4xl mx-auto p-4 lg:p-6 space-y-6">
  <!-- Header -->
  <div class="flex items-center gap-4 mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white m-0">
      Configurações
    </h1>
  </div>

  <!-- General Preferences Section -->
  <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Preferências Gerais</h2>

    <div class="flex flex-col gap-4">
      <!-- Theme -->
      <div class="flex flex-col gap-2">
        <label class="font-medium text-gray-700 dark:text-gray-300">Tema</label>
        <p-select [options]="themeOptions" [(ngModel)]="selectedTheme" (onChange)="onThemeChange()" optionLabel="label"
          optionValue="value" styleClass="w-full max-w-md" appendTo="body"></p-select>
      </div>
    </div>
  </div>

  <!-- Profile Section -->
  <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Perfil</h2>

    <div class="flex flex-col gap-6">
      <!-- Profile Picture -->
      <div class="flex items-center gap-4">
        <div class="relative">
          <img [src]="profileImageUrl()" alt="Profile"
            class="w-24 h-24 rounded-full object-cover border-4 border-gray-100 dark:border-slate-700"
            onerror="this.src='assets/default-avatar.png'">
        </div>
        <div class="flex flex-col gap-2">
          <p-fileUpload mode="basic" chooseLabel="Alterar Foto" name="avatar" accept="image/*" maxFileSize="1000000"
            [auto]="true" customUpload="true" (uploadHandler)="onUpload($event)"
            styleClass="p-button-outlined p-button-secondary p-button-sm"></p-fileUpload>
          <small class="text-gray-500 dark:text-gray-400">Max 1MB. JPG/PNG.</small>
        </div>
      </div>

      <!-- Full Name -->
      <div class="flex flex-col gap-2">
        <label for="displayName" class="font-medium text-gray-700 dark:text-gray-300">Nome Completo</label>
        <input pInputText id="displayName" [(ngModel)]="displayName" class="w-full" />
      </div>

      <!-- Update Button -->
      <div class="mt-2">
        <p-button label="Atualizar Perfil" styleClass="w-full bg-blue-600 border-blue-600 hover:bg-blue-700 text-white"
          (onClick)="updateProfile()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Email & Password Section -->
  <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Email e Segurança</h2>

    <div class="flex flex-col gap-6">
      <!-- Email -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div class="flex flex-col gap-1">
          <span class="font-medium text-gray-700 dark:text-gray-300">Email</span>
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-gray-900 dark:text-white font-medium">{{ email() }}</span>
            <p-tag *ngIf="auth.currentUser()?.emailVerified" value="Verificado" severity="success"
              styleClass="text-xs"></p-tag>
            <p-tag *ngIf="!auth.currentUser()?.emailVerified" value="Não Verificado" severity="warn"
              styleClass="text-xs cursor-pointer" (click)="verifyEmail()"
              pTooltip="Clique para enviar email de verificação"></p-tag>
          </div>
        </div>
        <p-button label="Editar email" styleClass="p-button-outlined p-button-secondary" size="small"></p-button>
      </div>

      <hr class="border-gray-100 dark:border-gray-700" />

      <!-- Password -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div class="flex flex-col gap-1">
          <span class="font-medium text-gray-700 dark:text-gray-300">Senha</span>
          <span class="text-sm text-gray-500 dark:text-gray-400">Alterar sua senha de acesso</span>
        </div>
        <p-button label="Alterar senha" styleClass="p-button-outlined p-button-secondary" size="small"
          (onClick)="sendPasswordReset()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Multi-Factor Authentication -->
  <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Autenticação de Dois Fatores (MFA)</h2>

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div class="flex flex-col gap-1">
        <div class="flex items-center gap-2">
          <span class="font-medium text-gray-700 dark:text-gray-300">Status do MFA</span>
          <p-tag *ngIf="mfaEnabled()" value="Ativado" severity="success" styleClass="text-xs"></p-tag>
          <p-tag *ngIf="!mfaEnabled()" value="Desativado" severity="warn"
            styleClass="text-xs bg-orange-100 text-orange-800"></p-tag>
        </div>
        <span class="text-sm text-gray-500 dark:text-gray-400">Proteja sua conta com uma camada extra de
          segurança</span>
      </div>

      <p-button *ngIf="!mfaEnabled()" label="Ativar MFA" styleClass="p-button-outlined p-button-secondary" size="small"
        (onClick)="startMfaSetup()"></p-button>
      <p-button *ngIf="mfaEnabled()" label="Desativar MFA" styleClass="p-button-outlined p-button-danger" size="small"
        (onClick)="disableMFA()"></p-button>
    </div>
  </div>

  <p-dialog header="Configurar MFA" [(visible)]="showMfaSetupDialog" [modal]="true" [style]="{width: '400px'}"
    styleClass="dark:bg-slate-800">
    <div class="flex flex-col items-center gap-6 py-4">
      <p class="text-center text-gray-600 dark:text-gray-300">Escaneie o QR Code abaixo com seu aplicativo autenticador
        (Google Authenticator, Authy, etc).</p>

      <div class="bg-white p-2 rounded-lg border border-gray-200">
        <img [src]="qrCodeUrl()" alt="QR Code" class="w-48 h-48">
      </div>

      <div class="flex flex-col gap-2 w-full">
        <label for="mfaToken" class="font-medium text-gray-700 dark:text-gray-300">Código de Verificação</label>
        <input pInputText id="mfaToken" [(ngModel)]="mfaToken"
          class="w-full text-center text-2xl tracking-[0.5em] font-mono" maxlength="6" placeholder="000000">
      </div>

      <div class="flex justify-end gap-2 w-full mt-2">
        <p-button label="Cancelar" styleClass="p-button-text" (onClick)="showMfaSetupDialog.set(false)"></p-button>
        <p-button label="Verificar e Ativar" (onClick)="confirmEnableMFA()"
          [disabled]="mfaToken().length !== 6"></p-button>
      </div>
    </div>
  </p-dialog>

  <!-- Account Data -->
  <div
    class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 border-l-4 border-l-red-500">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Zona de Perigo</h2>

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div class="flex flex-col gap-1">
        <span class="font-medium text-gray-700 dark:text-gray-300">Gerenciar Dados</span>
        <p class="text-sm text-gray-500 dark:text-gray-400 max-w-xl">
          Ações irreversíveis relacionadas à sua conta e dados.
        </p>
      </div>
      <div class="flex gap-3">
        <p-button label="Limpar Dados" styleClass="p-button-outlined p-button-secondary" size="small"
          (onClick)="onResetAccount()">
        </p-button>
        <p-button label="Excluir Conta" styleClass="p-button-outlined p-button-danger" size="small"
          (onClick)="confirmDelete()">
        </p-button>
      </div>
    </div>
  </div>
</div>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>