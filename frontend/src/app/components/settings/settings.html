<div class="max-w-4xl mx-auto p-6 space-y-6">
  <!-- Header -->
  <div class="flex items-center gap-4 mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white m-0">
      Configurações
    </h1>
  </div>

  <!-- General Preferences Section -->
  <p-card header="Preferências Gerais" styleClass="bg-white text-gray-900">
    <div class="flex flex-col gap-4">
      <!-- Theme -->
      <div class="flex flex-col gap-2">
        <label class="font-medium text-gray-900 dark:text-white">Tema</label>
        <p-select [options]="themeOptions" [(ngModel)]="selectedTheme" (onChange)="onThemeChange()" optionLabel="label"
          optionValue="value" styleClass="w-full max-w-md">
        </p-select>
      </div>

      <!-- Language -->
      <!--<div class="flex flex-col gap-2">
        <label class="font-medium text-gray-900 dark:text-white">Idioma</label>
        <p-select [options]="[{label: 'Português (Brasil)', value: 'pt-BR'}, {label: 'English (US)', value: 'en-US'}]"
          [ngModel]="preferences?.language" (onChange)="onLanguageChange($event)" optionLabel="label"
          optionValue="value" styleClass="w-full max-w-md">
        </p-select>
      </div>-->

      <!-- Notifications (Temporarily Hidden)
      <div class="flex items-center gap-2">
        <p-toggleswitch [ngModel]="preferences?.notifications_enabled"
          (onChange)="onNotificationChange($event)"></p-toggleswitch>
        <label class="font-medium text-gray-900 dark:text-white">Habilitar Notificações</label>
      </div>
      -->
    </div>
  </p-card>

  <!-- Profile Section -->
  <p-card header="Perfil" styleClass="bg-white text-gray-900">
    <div class="flex flex-col gap-6">
      <!-- Profile Picture -->
      <div class="flex items-center gap-4">
        <div class="relative">
          <img [src]="profileImageUrl()" alt="Profile"
            class="w-24 h-24 rounded-full object-cover border-2 border-gray-200 dark:border-gray-700"
            onerror="this.src='assets/default-avatar.png'">
        </div>
        <div class="flex flex-col gap-2">
          <p-fileUpload mode="basic" chooseLabel="Alterar Foto" name="avatar" accept="image/*" maxFileSize="1000000"
            [auto]="true" customUpload="true" (uploadHandler)="onUpload($event)"
            styleClass="p-button-outlined p-button-secondary p-button-sm"></p-fileUpload>
          <small class="text-gray-700">Max 1MB. JPG/PNG.</small>
        </div>
      </div>

      <!-- Full Name -->
      <div class="flex flex-col gap-2">
        <label for="displayName" class="font-medium text-gray-900 dark:text-white">Nome Completo</label>
        <input pInputText id="displayName" [(ngModel)]="displayName" class="w-full" />
      </div>

      <!-- Birthday -->
      <!--<div class="flex flex-col gap-2">
        <label for="birthday" class="font-medium text-gray-900 dark:text-white">Data de Nascimento</label>
        <p-datepicker [(ngModel)]="birthday" [showIcon]="true" inputId="birthday" placeholder="Data">
        </p-datepicker>
      </div>-->

      <!-- Timezone (Temporarily Hidden)
      <div class="flex flex-col gap-2">
        <label for="timezone" class="font-medium text-gray-900 dark:text-white">Fuso Horário</label>
        <p-select [options]="timezones" [(ngModel)]="selectedTimezone" optionLabel="label" optionValue="value"
          styleClass="w-full">
        </p-select>
      </div>
      -->

      <!-- Update Button -->
      <div class="mt-2">
        <p-button label="Atualizar Perfil"
          styleClass="w-full bg-orange-300 border-orange-300 hover:bg-orange-400 text-white"
          (onClick)="updateProfile()">
        </p-button>
      </div>
    </div>
  </p-card>

  <!-- Email & Password Section -->
  <p-card header="Email e Senha" styleClass="bg-white text-gray-900">
    <div class="flex flex-col gap-6">
      <!-- Email -->
      <div class="flex justify-between items-start">
        <div class="flex flex-col gap-1">
          <span class="font-medium text-gray-900 dark:text-white">Email</span>
          <div class="flex items-center gap-2">
            <span class="text-gray-800 dark:text-gray-100">{{
              email()
              }}</span>
            <p-tag *ngIf="auth.currentUser()?.emailVerified" value="Verificado" severity="success"
              styleClass="text-xs"></p-tag>
            <p-tag *ngIf="!auth.currentUser()?.emailVerified" value="Não Verificado" severity="warn"
              styleClass="text-xs cursor-pointer" (click)="verifyEmail()"
              pTooltip="Click to send verification email"></p-tag>
          </div>
        </div>
        <p-button label="Editar email" styleClass="p-button-outlined p-button-secondary" size="small"></p-button>
      </div>

      <hr class="border-gray-200 dark:border-gray-700" />

      <!-- Password -->
      <div class="flex justify-between items-start">
        <div class="flex flex-col gap-1">
          <span class="font-medium text-gray-900 dark:text-white">Senha</span>
          <span class="text-gray-800 dark:text-gray-100">Clique no botão para alterar sua senha</span>
        </div>
        <p-button label="Alterar senha" styleClass="p-button-outlined p-button-secondary" size="small"
          (onClick)="sendPasswordReset()">
        </p-button>
      </div>
    </div>
  </p-card>

  <!-- Multi-Factor Authentication -->
  <p-card header="Autenticação de Dois Fatores (MFA)" styleClass="bg-white text-gray-900">
    <div class="flex justify-between items-start">
      <div class="flex flex-col gap-1">
        <div class="flex items-center gap-2">
          <span class="font-medium text-gray-900 dark:text-white">Autenticação de Dois Fatores</span>
          <p-tag *ngIf="mfaEnabled()" value="Ativado" severity="success" styleClass="text-xs"></p-tag>
          <p-tag *ngIf="!mfaEnabled()" value="Desativado" severity="warn"
            styleClass="text-xs bg-orange-100 text-orange-800"></p-tag>
        </div>
        <span class="text-gray-800 dark:text-gray-100">Proteja sua conta com uma etapa extra de segurança</span>
      </div>
      <p-button *ngIf="!mfaEnabled()" label="Ativar MFA" styleClass="p-button-outlined p-button-secondary" size="small"
        (onClick)="startMfaSetup()"></p-button>
      <p-button *ngIf="mfaEnabled()" label="Desativar MFA" styleClass="p-button-outlined p-button-danger" size="small"
        (onClick)="disableMFA()"></p-button>
    </div>
  </p-card>

  <p-dialog header="Configurar MFA" [(visible)]="showMfaSetupDialog" [modal]="true" [style]="{width: '400px'}">
    <div class="flex flex-col items-center gap-4">
      <p>Escaneie o QR Code abaixo com seu aplicativo autenticador (Google Authenticator, Authy, etc).</p>
      <img [src]="qrCodeUrl()" alt="QR Code" class="w-48 h-48 border rounded">

      <div class="flex flex-col gap-2 w-full">
        <label for="mfaToken">Digite o código de 6 dígitos</label>
        <input pInputText id="mfaToken" [(ngModel)]="mfaToken" class="w-full text-center text-xl tracking-widest"
          maxlength="6" placeholder="000000">
      </div>

      <div class="flex justify-end gap-2 w-full mt-4">
        <p-button label="Cancelar" styleClass="p-button-text" (onClick)="showMfaSetupDialog.set(false)"></p-button>
        <p-button label="Verificar e Ativar" (onClick)="confirmEnableMFA()"
          [disabled]="mfaToken().length !== 6"></p-button>
      </div>
    </div>
  </p-dialog>

  <!-- Account Data -->
  <p-card header="Dados da Conta" styleClass="bg-white text-gray-900">
    <div class="flex justify-between items-start">
      <div class="flex flex-col gap-1">
        <span class="font-medium text-gray-900 dark:text-white">Excluir conta</span>
        <p class="text-gray-800 dark:text-gray-100 text-sm max-w-xl">
          Exclua sua conta e todos os dados associados. Esta ação é permanente
          e não pode ser desfeita.
        </p>
      </div>
      <div class="flex gap-2">
        <p-button label="Limpar Conta"
          styleClass="p-button-outlined p-button-secondary text-gray-700 border-gray-300 hover:bg-gray-50" size="small"
          (onClick)="onResetAccount()">
        </p-button>
        <p-button label="Excluir conta"
          styleClass="p-button-outlined p-button-danger text-red-500 border-red-200 hover:bg-red-50" size="small"
          (onClick)="confirmDelete()">
        </p-button>
      </div>
    </div>
  </p-card>
</div>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>