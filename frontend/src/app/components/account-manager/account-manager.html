<div class="mb-8">

  <div class="flex justify-between items-center mb-6">
    <h2 class="text-xl font-bold text-gray-800 dark:text-white">Gerenciar Contas</h2>
    <p-button label="Nova Conta" icon="pi pi-plus" size="small" (onClick)="openNew()"></p-button>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    @for (acc of accounts(); track acc.id) {
    <div
      class="bg-white dark:bg-slate-800 p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow flex flex-col justify-between h-40 relative group overflow-hidden">
      <div class="absolute left-0 top-0 bottom-0 w-2" [style.backgroundColor]="acc.color"></div>

      <i [class]="acc.icon" class="absolute -right-4 -bottom-4 text-8xl opacity-10 pointer-events-none"
        [style.color]="acc.color">
      </i>

      <div
        class="absolute top-3 right-3 flex gap-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity z-20">
        <button (click)="editAccount($event, acc)"
          class="relative w-8 h-8 rounded-full bg-gray-50 dark:bg-slate-700 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center transition-colors shadow-sm cursor-pointer">
          <i class="pi pi-pencil text-sm"></i>
        </button>
        <button (click)="deleteAccount($event, acc.id!)"
          class="relative w-8 h-8 rounded-full bg-gray-50 dark:bg-slate-700 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 flex items-center justify-center transition-colors shadow-sm cursor-pointer">
          <i class="pi pi-trash text-sm"></i>
        </button>
      </div>

      <div class="pl-3 relative z-10">
        <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 flex items-center gap-2">
          <i [class]="acc.icon" [style.color]="acc.color"></i>
          {{ acc.type | accountType }}
        </div>
        <div class="text-xl font-bold text-gray-800 dark:text-white truncate pr-16" title="{{ acc.name }}">
          {{ acc.name }}
        </div>
      </div>

      <div class="pl-3 mt-auto relative z-10">
        <span class="text-2xl font-bold tracking-tight" [style.color]="acc.color">
          {{ acc.balance | currency : "BRL" }}
        </span>
      </div>
    </div>
    }

    <div (click)="openNew()"
      class="border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl p-5 flex flex-col items-center justify-center h-40 cursor-pointer hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all group text-gray-400 hover:text-blue-500">
      <i class="pi pi-plus text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
      <span class="font-medium">Adicionar Conta</span>
    </div>
  </div>
</div>

<p-dialog [header]="editingId() ? 'Editar Conta' : 'Nova Conta'" [modal]="true" [(visible)]="visible"
  [style]="{ width: '25rem' }" [draggable]="false" [resizable]="false">
  <form [formGroup]="form" (ngSubmit)="saveAccount()" class="flex flex-col gap-4 pt-4">
    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-700 dark:text-gray-300">Nome da Conta</label>
      <input pInputText formControlName="name" class="w-full" placeholder="Ex: Nubank" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-700 dark:text-gray-300">Tipo</label>
      <p-select [options]="typeOptions" formControlName="type" optionLabel="label" optionValue="value"
        [style]="{ width: '100%' }" appendTo="body"></p-select>
    </div>

    <div class="flex gap-4 items-end">
      <div class="flex-1 flex flex-col gap-2">
        <label class="font-semibold text-gray-700 dark:text-gray-300">√çcone</label>
        <p-select [options]="icons" formControlName="icon" optionLabel="label" optionValue="value"
          [style]="{ width: '100%' }" appendTo="body" placeholder="Selecione...">
          <ng-template pTemplate="item" let-i>
            <div class="flex items-center gap-2">
              <i [class]="i.value" class="text-lg"></i>
              <span>{{ i.label }}</span>
            </div>
          </ng-template>

          <ng-template pTemplate="selectedItem" let-i>
            @if (i) {
            <div class="flex items-center gap-2">
              <i [class]="i.value"></i>
              <span>{{ i.label }}</span>
            </div>
            }
          </ng-template>
        </p-select>
      </div>

      <div class="flex flex-col gap-2 items-center">
        <label class="font-semibold text-gray-700 dark:text-gray-300">Cor</label>
        <p-colorPicker formControlName="color" appendTo="body"></p-colorPicker>
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-700 dark:text-gray-300">Saldo Atual</label>
      <p-inputNumber formControlName="balance" mode="currency" currency="BRL" locale="pt-BR" [style]="{ width: '100%' }"
        inputStyleClass="w-full"></p-inputNumber>
    </div>

    <div class="flex justify-end mt-4">
      <p-button label="Salvar" type="submit" [disabled]="form.invalid"></p-button>
    </div>
  </form>
</p-dialog>